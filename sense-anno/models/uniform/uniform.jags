
model {
    pi ~ ddirch(alpha)
    for (i in 1:I) {
        z[i] ~ dcat(pi)
    }

    for (j in 1:J) {
        for (k in 1:K) {
	    theta[j,k,1:K] ~ ddirch(alpha)
        }
    }

    for (n in 1:N) {
        y[n] ~ dcat(theta[jj[n], z[ii[n]], 1:K]);
    }
}
