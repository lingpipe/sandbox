model {

    pi ~ ddirch(alpha)
    for (i in 1:I) {
        z[i] ~ dcat(pi)
    }

    for (k in 1:K) {
        kappa[k] ~ dpar(1.5,0.25);
        phi[k,1:K] ~ ddirch(gamma[k,1:K]);
        for (k2 in 1:K) {
	    beta[k,k2] <- kappa[k] * phi[k,k2] + 0.1;  
	}
    }

    for (j in 1:J) {
        for (k in 1:K) {
	    theta[j,k,1:K] ~ ddirch(beta[k,1:K])
        }
    }

    for (n in 1:N) {
        y[n] ~ dcat(theta[jj[n], z[ii[n]], 1:K])
    }
}

