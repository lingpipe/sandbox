<?xml version="1.0"?>
<project name="lingmed" default="compile" basedir=".">

<property file="build.lingmed.properties"/>

<import file="build_common.xml"/>

<target name="test-compile"
        depends="compile"
        description="Compiles test classes">
  <javac optimize="on"
         debug="yes"
         debuglevel="source,lines,vars"
         destdir="build/classes">
    <classpath refid="classpath.standard"/>
    <classpath refid="classpath.test"/>
    <include name="com/aliasi/lingmed/test/**"/>
    <src path="src"/>
  </javac>
</target>

<target name="test-jar"
        depends="test-compile">
  <copy todir="build/classes">
    <fileset dir="${basedir}"
             includes="*.properties" />
  </copy>
  <jar destfile="${jar}">
    <fileset dir="build/classes"
             includes="**/*.class **/*.properties" />
  </jar>
</target>

<target name="split-medline">
  <java classname="com.aliasi.lingmed.medline.SplitMedlineXml" fork="true">
    <arg value="medsamp2009.xml"/>
    <arg value="tmp2"/>
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
  </java>
</target>

<target name="split-omim">
  <java classname="com.aliasi.lingmed.omim.SplitOmimDist" fork="true">
    <arg value="${nlm.data}\mim\omim.txt"/>
    <arg value="tmp2"/>
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
  </java>
</target>

<target name="count-entrez-refs"
        description="gen histogram of number of unique pubmed refs per gene"
        depends="jar">
  <java classname="com.aliasi.lingmed.entrezgene.CountEntrezGene"
        maxMemory="4G"
        fork="true">
    <classpath refid="classpath.standard"/>
    <arg value="-host=${rmi.server.address}"/>
  </java>
</target>

<target name="test-dict"
        description="test compiled exact match dictionary"
        depends="jar">
  <java classname="com.aliasi.lingmed.lingblast.TestDictionary"
        maxMemory="2G"
        fork="true">
    <classpath refid="classpath.standard"/>
    <arg value="exactDictEntrezGene"/>
    <arg value="lmTextHtml/114757.html"/>
  </java>
</target>

<target name="test-lm"
        description="test compiled lm"
        depends="jar">
  <java classname="com.aliasi.lingmed.lingblast.TestLM"
        maxMemory="2G"
        fork="true">
    <classpath refid="classpath.standard"/>
    <arg value="lmTexts/genomic.ngram.lm"/>
  </java>
</target>

<target name="xval-genomics"
        description="cross-validate genomics lm"
        depends="jar">
  <java classname="com.aliasi.lingmed.lingblast.XValidateGenomics"
        maxMemory="8G"
        fork="true">
    <classpath refid="classpath.standard"/>
    <arg value="${rmi.server.address}"/>
    <arg value="${rmi.server.port}"/>
  </java>
</target>

<target name="test-rmiMedline"
        description="test rmi MEDLINE search"
        depends="jar">
  <java classname="com.aliasi.lingmed.server.TestClient"
        maxMemory="1G"
        fork="true">
    <classpath refid="classpath.standard"/>
    <arg value="${rmi.server.address}"/>
    <arg value="test_pmids.txt"/>
  </java>
</target>

<target name="db-genelinkage"
        description="test genelinkage db"
        depends="jar">
  <java classname="com.aliasi.lingmed.genelinkage.TestDb"
        fork="true">
    <classpath>
      <path refid="classpath.standalone.db"/>
    </classpath>
    <arg value="check_pmids.txt"/>
  </java>
</target>

<target name="num-hits"
        depends="jar">
  <java classname="com.aliasi.lingmed.lucene.NumHits"
        fork="true">
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
    <arg value="${medline.lucene.index.dir}"/>
    <arg value="of the"/>
    <arg value="p-53"/>
    <arg value="p53"/>
    <arg value="P53"/>
    <arg value="the"/>
    <arg value="The"/>
    <arg value="and the"/>
  </java>
</target>

<target name="search-medline-codec"
        depends="jar">
  <java classname="com.aliasi.lingmed.medline.SearchableMedlineCodec"
        fork="true">
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
  </java>
</target>

<target name="dump-medline-dates"
        description="get pubdate for all citations in MEDLINE index"
        depends="test-jar">
  <java classname="com.aliasi.lingmed.medline.VerifyDates"
        fork="true">
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
    <arg value="luceneMedline"/>
  </java>
</target>

<target name="medline-search-dates"
        description="test MEDLINE searcher getCitationsInYearRange"
        depends="test-jar">
  <java classname="com.aliasi.lingmed.medline.TestDateSearch"
        fork="true">
    <classpath>
      <path refid="classpath.standard"/>
    </classpath>
    <arg value="luceneMedline"/>
  </java>
</target>


<target name="update-classname"
        depends=""
        description="Replace class name">
    <replace dir="src"
             includes ="**/*.java">
      <replacetoken><![CDATA[FileSys]]></replacetoken>
      <replacevalue><![CDATA[FileUtils]]></replacevalue>
    </replace>
 </target>

</project>
